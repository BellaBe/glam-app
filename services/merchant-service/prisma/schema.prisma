datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider             = "prisma-client-py"
  interface            = "asyncio"
  recursive_type_depth = 5
}

enum MerchantStatus {
  PENDING      // Installed but never activated (no trial, no credits)
  ACTIVE       // Has trial OR credits (can use all features)
  PAUSED       // No trial, no credits (dormant but installed)
  SUSPENDED    // Temporarily disabled (abuse, violation, etc.)
  UNINSTALLED  // App removed
}

model Merchant {
  id                String   @id @default(uuid()) @db.Uuid

  // Platform Identity (immutable after creation)
  platform_name          String              // 'shopify', 'woocommerce', etc.
  platform_id       String              // gid://shopify/Shop/123
  platform_domain   String              // bb-staging-test.myshopify.com (PERMANENT)

  // Basic Info
  name              String              // Shop/Store name
  email             String              // Contact email
  primary_domain    String?             // Current primary domain (could be custom)
  currency          String @default("USD")
  country           String?

  // Platform Details
  platform_version  String              // API version (2024-01, etc.)
  scopes           String?              // What permissions were granted

  // Lifecycle
  status            MerchantStatus @default(PENDING)
  status_changed_at DateTime?           // When status last changed

  installed_at      DateTime @default(now())
  uninstalled_at    DateTime?
  last_sync_at      DateTime?           // When we last synced with platform

  // Timestamps
  created_at        DateTime @default(now()) @db.Timestamptz(3)
  updated_at        DateTime @updatedAt @db.Timestamptz(3)

  @@unique([platform_name, platform_id])
  @@unique([platform_name, platform_domain])
  @@index([platform_id, platform_domain])
  @@index([platform_domain])
  @@index([status])
  @@map("merchants")
}
