generator client {
  provider             = "prisma-client-py"
  interface            = "asyncio"
  recursive_type_depth = 5
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model WebhookEntry {
  id                  String    @id @default(uuid()) @db.Uuid
  platform            String    @db.VarChar(50)
  topic_raw           String    @db.VarChar(120)
  topic_enum          String    @db.VarChar(100)
  shop_domain         String    @db.Text  // Case-insensitive in Postgres with CITEXT
  webhook_id          String    @unique @db.VarChar(100)
  api_version         String?   @db.VarChar(20)
  signature           String    @db.Text
  headers             Json
  payload             Json
  payload_bytes       Int?
  status              String    @db.VarChar(20)
  processing_attempts Int       @default(0)
  error_message       String?   @db.Text
  received_at         DateTime  @default(now()) @db.Timestamptz(3)
  processed_at        DateTime? @db.Timestamptz(3)
  created_at          DateTime  @default(now()) @map("created_at") @db.Timestamptz(3)
  updated_at          DateTime  @updatedAt @map("updated_at") @db.Timestamptz(3)
  
  @@index([platform, topic_enum, received_at(sort: Desc)])
  @@index([shop_domain, received_at(sort: Desc)])
  @@index([status, created_at])
  @@map("webhook_entries")
}


