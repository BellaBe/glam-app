test:
	poetry run pytest --cov=src --cov-report=html

test-unit:
	poetry run pytest tests/unit/ -v

test-integration:
	poetry run pytest tests/integration/ -v

# Code quality
lint:
	poetry run black --check .
	poetry run isort --check-only .
	poetry run flake8 .
	poetry run mypy src/

format:
	poetry run black .
	poetry run isort .

# Database migrations
migrate:
	poetry run alembic upgrade head

migration:
	poetry run alembic revision --autogenerate -m "$(msg)"

# Docker operations
docker-build:
	docker-compose build

docker-run:
	docker-compose up -d

docker-logs:
	docker-compose logs -f analytics-service

docker-stop:
	docker-compose down

# Background tasks (for testing)
run-daily-aggregation:
	poetry run python scripts/run_daily_aggregation.py

run-pattern-detection:
	poetry run python scripts/run_pattern_detection.py

run-alert-evaluation:
	poetry run python scripts/run_alert_evaluation.py

# Analytics utilities
generate-sample-data:
	poetry run python scripts/generate_sample_data.py

test-predictions:
	poetry run python scripts/test_predictions.py

